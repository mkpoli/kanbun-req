---
import type { TypstDocInput } from "astro-typst/dist/lib/prelude";
import { Typst } from "astro-typst/src/components";

const typstInput: TypstDocInput = {
	mainFilePath: "main.typ",
	inputs: {
		target: "html",
	},
};
---

<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<!-- <link rel="icon" type="image/svg+xml" href="/favicon.svg" /> -->
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<meta name="description" content="訓点漢文の組版にあたって求められる事項について説明する文書 / Requirements for Annotated Kanbun Text Layout" />
		
		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website" />
		<meta property="og:url" content="https://kanbun-req.mkpo.li/" />
		<meta property="og:title" content="訓点漢文組版要件 / Requirements for Annotated Kanbun Text Layout" />
		<meta property="og:description" content="訓点漢文の組版にあたって求められる事項について説明する文書 / Requirements for Annotated Kanbun Text Layout" />
		<meta property="og:locale" content="ja_JP" />

		<!-- Twitter -->
		<meta property="twitter:card" content="summary" />
		<meta property="twitter:url" content="https://kanbun-req.mkpo.li/" />
		<meta property="twitter:title" content="訓点漢文組版要件 / Requirements for Annotated Kanbun Text Layout" />
		<meta property="twitter:description" content="訓点漢文の組版にあたって求められる事項について説明する文書 / Requirements for Annotated Kanbun Text Layout" />
		
		<link rel="canonical" href="https://kanbun-req.mkpo.li/" />
		<title>訓点漢文組版要件 / Requirements for Annotated Kanbun Text Layout</title>
		<style is:global>
			body {
				display: flex;
				flex-direction: column;
				font-family: "Harano Aji Mincho", "Noto Serif CJK JP", serif;
				line-height: 1.6;
				max-width: 800px;
				margin: 0 auto;
				padding: 2rem;
				color: #333;
			}
			a[href^="http"] {
				text-decoration: none;
				color: #144a9a;
			}
			a[href^="#"] {
				color: orange;
				text-decoration: none;
			}
			.typst-frame { margin: auto }

			/* Heading Styles */
			h1 {
				text-align: center;
				font-size: 1.8rem;
				margin-top: 2rem;
				margin-bottom: 1.5rem;
			}
			h2 {
				font-size: 1.4rem;
				margin-top: 1.5rem;
				margin-bottom: 1rem;
				border-bottom: 1px solid #eee;
				padding-bottom: 0.3rem;
			}
			h3 {
				font-size: 1.2rem;
				margin-top: 1.2rem;
				margin-bottom: 0.8rem;
			}

			/* Table Styles */
			table {
				border-collapse: collapse;
				width: 100%;
				margin: 1.5rem 0;
			}
			th {
				border-bottom: 2px solid black;
				padding: 0.5rem;
				text-align: center;
				font-weight: bold;
			}
			@font-face {
				font-family: "Harano Aji Mincho";
				src: url("/fonts/HaranoAjiMincho-Regular.otf") format("opentype");
				font-weight: normal;
				font-style: normal;
			}
			@font-face {
				font-family: "Harano Aji Mincho";
				src: url("/fonts/HaranoAjiMincho-Bold.otf") format("opentype");
				font-weight: bold;
				font-style: normal;
			}
			td {
				border-bottom: 1px solid black;
				padding: 0.5rem;
				text-align: left;
			}
			.author {
				text-align: center;
				font-size: 1.1rem;
				margin-bottom: 2rem;
			}
			/* Specific adjustments for the characters table alignment if possible, 
			   but generic center/left logic is a safe baseline. */ 
		</style>
	</head>
	<body>
		{/* @ts-ignore: htmlMode is not in the type definition but is supported by the renderer */}
		<Typst input={typstInput} htmlMode="text" target="html" />
		<script>
			// Inline SVG images to allow CSS styling
			document.addEventListener("DOMContentLoaded", () => {
				const images = document.querySelectorAll('img[src^="data:image/svg+xml"]');
				images.forEach(async (img) => {
					try {
						const src = img.getAttribute("src");
						if (!src) return;
						
						const res = await fetch(src);
						const text = await res.text();
						
						const parser = new DOMParser();
						const doc = parser.parseFromString(text, "image/svg+xml");
						const svg = doc.querySelector("svg");
						
						if (svg && img.parentNode) {
							// Copy attributes if needed (e.g., classes)
							if (img.className) svg.setAttribute("class", img.className);
							if (img.id) svg.setAttribute("id", img.id);
							
							img.parentNode.replaceChild(svg, img);
						}
					} catch (e) {
						console.error("Failed to inline SVG:", e);
					}
				});
			});
		</script>
	</body>
</html>
